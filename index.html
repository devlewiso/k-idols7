<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-SABER MAYA ‚ú® (7 A√±os)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700;800&family=Chivo:wght@400;700;900&display=swap');
        
        * {
            font-family: 'Fredoka', sans-serif;
        }
        
        /* --- NUEVA PALETA DE COLORES Y FONDO --- */
        
        /* Colores: Esmeralda (#00A36C), Azul Profundo (#124F8A), Arena (#F5DEB3), Oro (#FFD700) */
        
        body {
            /* Degradado de Selva y Cielo Nocturno */
            background: linear-gradient(135deg, #00A36C 0%, #008053 40%, #124F8A 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            min-height: 100vh;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .main-card {
            /* Textura de Piedra Clara / Arena */
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border: 5px solid #00A36C; /* Borde Esmeralda */
            box-shadow: 
                0 0 30px rgba(18, 79, 138, 0.4), /* Sombra Azul */
                0 0 60px rgba(0, 163, 108, 0.3), /* Sombra Esmeralda */
                0 15px 40px rgba(0, 0, 0, 0.3);
            max-width: 95%;
            width: 550px;
            border-radius: 20px;
            animation: none; /* Quitamos el heartbeat */
        }
        
        .title-main {
            font-family: 'Chivo', sans-serif;
            font-size: 3.5rem;
            /* Degradado de Oro a Verde */
            background: linear-gradient(135deg, #FFD700, #00A36C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 0px rgba(18, 79, 138, 0.3);
            letter-spacing: 2px;
            animation: pulse-slow 5s ease-in-out infinite;
        }

        @keyframes pulse-slow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        
        .game-button {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            padding: 1rem 1.5rem;
            border: 4px solid;
            border-radius: 12px;
            transition: all 0.2s;
            cursor: pointer;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.4); /* Sombra de profundidad de piedra */
            position: relative;
            top: 0;
            animation: none; /* Quitamos el float */
        }
        
        .game-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.4);
        }
        
        .game-button:active {
            transform: translateY(2px);
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.4);
        }
        
        /* Botones Tem√°ticos */
        .btn-green-jungle {
            background: linear-gradient(135deg, #00A36C, #008053);
            color: #F5DEB3; /* Texto color Arena */
            border-color: #008053;
        }
        
        .btn-blue-deep {
            background: linear-gradient(135deg, #124F8A, #0A3761);
            color: #F5DEB3; 
            border-color: #0A3761;
            font-weight: 700;
        }
        
        .btn-gold-sand {
            background: linear-gradient(135deg, #FFD700, #E0B500);
            color: #124F8A; /* Texto color Azul Profundo */
            border-color: #E0B500;
            font-weight: 900;
        }
        
        .option-tile {
            /* Fondo de la Runa */
            background: #F5DEB3; /* Color Arena */
            border: 4px solid #124F8A; /* Borde Azul Profundo */
            border-radius: 10px;
            padding: 1rem;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            color: #00A36C; /* Texto Esmeralda */
            box-shadow: 0 4px 0 rgba(18, 79, 138, 0.5);
        }
        
        .option-tile:hover {
            transform: translateY(-3px);
            background: #FFD700; /* Se ilumina a Dorado */
            color: #124F8A;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        
        .option-tile:active {
            transform: translateY(0);
            box-shadow: 0 2px 0 rgba(18, 79, 138, 0.5);
        }
        
        .correct-answer {
            /* Runa Activada */
            background: linear-gradient(135deg, #FFD700, #E0B500) !important;
            border-color: #124F8A !important;
            color: #124F8A !important;
            transform: scale(1.08) !important;
            box-shadow: 0 0 30px rgba(255, 215, 0, 1) !important;
            animation: sparkle 0.6s ease-out;
        }
        
        .incorrect-answer {
            background: linear-gradient(135deg, #124F8A, #0A3761) !important;
            border-color: #FFD700 !important;
            color: white !important;
            opacity: 0.8 !important;
            animation: shake 0.4s;
        }

        .level-badge {
            background: linear-gradient(135deg, #FFD700, #E0B500);
            color: #124F8A;
            font-weight: 800;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 1.2rem;
            display: inline-block;
            box-shadow: 0 4px 0 rgba(18, 79, 138, 0.2);
        }
        
        .score-badge {
            background: linear-gradient(135deg, #124F8A, #0A3761);
            color: #FFD700;
            font-weight: 800;
            padding: 0.7rem 1.5rem;
            border-radius: 20px;
            font-size: 1.3rem;
            box-shadow: 0 0 15px rgba(18, 79, 138, 0.6);
        }
        
        .display-content {
            /* Piedra Central de la Pregunta */
            background: #F5DEB3; /* Color Arena */
            border: 4px dashed #00A36C; /* Borde Esmeralda */
            border-radius: 20px;
            padding: 2rem;
            font-size: 3.5rem; /* M√°s peque√±o para texto */
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin: 1.5rem 0;
            animation: pulse 2s ease-in-out infinite;
            color: #124F8A; /* Texto Azul Profundo */
            font-weight: 900;
        }
        
        /* Estilos de Mensajes (Modal) */
        .message-content {
            background: linear-gradient(135deg, #124F8A, #00A36C);
            border: 5px solid #FFD700;
            color: white;
        }

        /* Mensajes de feedback en pantalla */
        .feedback-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: 900;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .feedback-correct {
            color: #124F8A;
            background-color: #FFD700;
            animation: popIn 0.5s ease-out forwards;
        }
        .feedback-incorrect {
            color: #F5DEB3;
            background-color: #0A3761;
            animation: shake 0.5s forwards;
        }
        
    </style>
</head>
<body>
    <div id="app" class="app-container"></div>

    <script type="module">
        const app = document.getElementById('app');
        let currentScreen = 'mainMenu';
        let currentLevel = 1;
        let score = 0;
        let gameData = {};
        
        // --- Datos de los Juegos (Edici√≥n 7 A√±os) ---
        
        // Matem√°ticas: M√°s de 50 preguntas
        const MATH_QUESTIONS = [
            // Nivel 1: Unidades y Decenas hasta 50, Sumas/Restas hasta 20
            { type: 'value', number: 23, question: '¬øCu√°l es el valor de las UNIDADES en 23?', answer: 3, max: 10, level: 1 },
            { type: 'value', number: 45, question: '¬øCu√°l es el valor de las DECENAS en 45?', answer: 40, max: 50, level: 1 },
            { type: 'sum', num1: 10, num2: 7, max: 20, level: 1 },
            { type: 'sum', num1: 9, num2: 8, max: 20, level: 1 },
            { type: 'count', object: 'planetas ü™ê', count: 18, max: 20, level: 1 },
            { type: 'count', object: 'diamantes üíé', count: 16, max: 19, level: 1 },
            { type: 'value', number: 31, question: '¬øCu√°ntas DECENAS tiene el n√∫mero 31?', answer: 3, max: 10, level: 1 },
            { type: 'subtract', num1: 15, num2: 5, max: 12, level: 1 },
            { type: 'value', number: 57, question: '¬øCu√°l es el valor de las UNIDADES en 57?', answer: 7, max: 10, level: 1 },
            { type: 'sum', num1: 11, num2: 8, max: 20, level: 1 },
            { type: 'count', object: 'monedas ü™ô', count: 19, max: 21, level: 1 },
            { type: 'subtract', num1: 19, num2: 7, max: 13, level: 1 },
            { type: 'sum', num1: 15, num2: 4, max: 20, level: 1 },
            { type: 'subtract', num1: 17, num2: 5, max: 13, level: 1 },
            { type: 'value', number: 89, question: '¬øCu√°l es el valor de las DECENAS en 89?', answer: 80, max: 90, level: 1 },
            { type: 'sum', num1: 14, num2: 6, max: 21, level: 1 },

            // Nivel 2: Suma y Resta hasta 30, Unidades/Decenas hasta 99
            { type: 'sum', num1: 12, num2: 6, max: 20, level: 2 },
            { type: 'sum', num1: 15, num2: 5, max: 21, level: 2 },
            { type: 'subtract', num1: 20, num2: 8, max: 13, level: 2 },
            { type: 'subtract', num1: 17, num2: 9, max: 9, level: 2 },
            { type: 'sum', num1: 11, num2: 9, max: 21, level: 2 },
            { type: 'subtract', num1: 16, num2: 7, max: 10, level: 2 },
            { type: 'sum', num1: 14, num2: 3, max: 20, level: 2 },
            { type: 'value', number: 50, question: '¬øCu√°ntas unidades son 5 decenas?', answer: 50, max: 60, level: 2 },
            { type: 'sum', num1: 13, num2: 7, max: 21, level: 2 },
            { type: 'subtract', num1: 18, num2: 6, max: 13, level: 2 },
            { type: 'value', number: 68, question: '¬øCu√°l es el valor de las DECENAS en 68?', answer: 60, max: 70, level: 2 },
            { type: 'sum', num1: 17, num2: 3, max: 21, level: 2 },
            { type: 'sum', num1: 20, num2: 10, max: 31, level: 2 },
            { type: 'subtract', num1: 25, num2: 10, max: 16, level: 2 },
            { type: 'value', number: 72, question: '¬øCu√°ntas UNIDADES tiene el n√∫mero 72?', answer: 2, max: 10, level: 2 },
            { type: 'sum', num1: 15, num2: 12, max: 28, level: 2 },
            { type: 'subtract', num1: 28, num2: 14, max: 15, level: 2 },
            { type: 'value', number: 99, question: '¬øCu√°l es el valor de las DECENAS en 99?', answer: 90, max: 100, level: 2 },
            { type: 'sum', num1: 16, num2: 13, max: 30, level: 2 },
            { type: 'subtract', num1: 30, num2: 12, max: 19, level: 2 },
            { type: 'value', number: 40, question: '¬øQu√© n√∫mero es 4 Decenas y 0 Unidades?', answer: 40, options: [4, 40, 400], level: 2 },
            { type: 'sum', num1: 22, num2: 7, max: 30, level: 2 },

            // Nivel 3: Patrones, Mitades, Mayor/Menor y Multiplicaci√≥n (Introducci√≥n)
            { type: 'comparison', num1: 19, num2: 9, question: '¬øQu√© n√∫mero es MAYOR? 19 √≥ 9', answer: 19, options: [19, 9, 10], level: 3},
            { type: 'comparison', num1: 11, num2: 15, question: '¬øQu√© n√∫mero es MENOR? 11 √≥ 15', answer: 11, options: [11, 15, 13], level: 3},
            { type: 'half', num: 10, question: '¬øCu√°l es la MITAD de 10?', answer: 5, max: 6, level: 3},
            { type: 'half', num: 14, question: '¬øCu√°l es la MITAD de 14?', answer: 7, max: 8, level: 3},
            { type: 'sequence', start: 5, step: 5, missing: 20, max: 26, question: 'Secuencia de 5 en 5: 5, 10, 15, ?', answer: 20, options: [21, 19, 20], level: 3},
            { type: 'sequence', start: 30, step: -10, missing: 10, max: 40, question: 'Cuenta de 10 en 10 hacia atr√°s: 30, 20, ?', answer: 10, options: [0, 5, 10], level: 3},
            { type: 'sum', num1: 8, num2: 12, max: 21, level: 3 },
            { type: 'subtract', num1: 18, num2: 11, max: 8, level: 3 },
            { type: 'half', num: 18, question: '¬øCu√°l es la MITAD de 18?', answer: 9, max: 10, level: 3},
            { type: 'sequence', start: 3, step: 3, missing: 12, max: 15, question: 'Secuencia de 3 en 3: 3, 6, 9, ?', answer: 12, options: [11, 13, 12], level: 3},
            { type: 'comparison', num1: 25, num2: 21, question: '¬øQu√© n√∫mero es MENOR? 25 √≥ 21', answer: 21, options: [25, 21, 23], level: 3},
            { type: 'sum', num1: 13, num2: 5, max: 20, level: 3 },
            { type: 'times', num1: 2, num2: 3, question: 'Hay 2 grupos de 3 manzanas. ¬øCu√°ntas hay en total? (2x3)', answer: 6, max: 7, level: 3, display: 'üçéüçéüçé ‚ûï üçéüçéüçé' },
            { type: 'times', num1: 5, num2: 1, question: '5 veces el n√∫mero 1 es igual a:', answer: 5, max: 6, level: 3, display: '1 + 1 + 1 + 1 + 1' },
            { type: 'comparison', num1: 30, num2: 33, question: '¬øQu√© n√∫mero es MAYOR? 30 √≥ 33', answer: 33, options: [30, 33, 31], level: 3},
            { type: 'sequence', start: 40, step: -5, missing: 30, max: 41, question: 'Cuenta de 5 en 5 hacia atr√°s: 40, 35, ?', answer: 30, options: [25, 30, 45], level: 3},
            { type: 'half', num: 20, question: '¬øCu√°l es la MITAD de 20?', answer: 10, max: 11, level: 3},
            { type: 'sum', num1: 14, num2: 15, max: 30, level: 3 },
            { type: 'subtract', num1: 27, num2: 10, max: 18, level: 3 },
            { type: 'value', number: 100, question: '¬øCu√°ntas DECENAS hay en 100?', answer: 10, max: 11, level: 3 },
        ];

        // Lectura y Lenguaje: M√°s de 50 preguntas
        const READING_QUESTIONS = [
            // Nivel 1: Reconocimiento de Diptongos, Aumentativos/Diminutivos, Ra√≠z
            { question: "¬øQu√© palabra tiene el sonido 'IE' (Diptongo)?", answer: 'MIEL', options: ['MESA', 'MIEL', 'SOL'], level: 1 },
            { question: "¬øCu√°l es la √∫ltima s√≠laba de 'PELO_ _ TA'?", answer: 'TA', options: ['LO', 'PE', 'TA'], level: 1 },
            { question: "¬øCu√°l es la letra que va despu√©s de la 'F'?", answer: 'G', options: ['E', 'G', 'H'], level: 1 },
            { question: "¬øQu√© palabra es un 'diminutivo' (peque√±o)?", answer: 'CASITA', options: ['CASONA', 'CASOTA', 'CASITA'], level: 1 },
            { question: "¬øCu√°l es la palabra primitiva de 'PANADERO'?", answer: 'PAN', options: ['HORNOS', 'PAN', 'COMIDA'], level: 1 },
            { question: "¬øQu√© palabra tiene dos 'R'?", answer: 'PERRO', options: ['CARO', 'PERRO', 'ERA'], level: 1 },
            { question: "La palabra 'ESTRELLA' tiene...", answer: '3 S√çLABAS', options: ['2 S√çLABAS', '4 S√çLABAS', '3 S√çLABAS'], level: 1 },
            { question: "¬øQu√© palabra empieza con 'FR'?", answer: 'FRIO', options: ['R√çO', 'FRIO', 'LIO'], level: 1 },
            { question: "¬øQu√© palabra tiene el sonido 'UA' (Diptongo)?", answer: 'AGUA', options: ['PATO', 'AGUA', 'MESA'], level: 1 },
            { question: "¬øQu√© palabra es un 'aumentativo' (muy grande)?", answer: 'PERRAZO', options: ['PERRITO', 'PERRO', 'PERRAZO'], level: 1 },
            { question: "¬øCu√°l es la letra que va antes de la 'P'?", answer: 'O', options: ['Q', 'O', 'N'], level: 1 },
            { question: "¬øQu√© palabra es de la familia de 'SOL'?", answer: 'SOLEADO', options: ['LUNA', 'CIELO', 'SOLEADO'], level: 1 },
            { question: "¬øQu√© palabra rima con 'SAPO'?", answer: 'TRAPO', options: ['MESA', 'GATO', 'TRAPO'], level: 1 },
            { question: "¬øCu√°l es la s√≠laba media de 'CA_ _ SA'?", answer: 'MI', options: ['CA', 'SA', 'MI'], level: 1 },
            { question: "¬øCu√°l es la palabra que tiene una 'B'?", answer: 'BARCO', options: ['PATO', 'CASA', 'BARCO'], level: 1 },
            { question: "La palabra 'CHOCOLATE' tiene...", answer: '4 S√çLABAS', options: ['3 S√çLABAS', '4 S√çLABAS', '5 S√çLABAS'], level: 1 },
            { question: "¬øQu√© palabra empieza con 'PL'?", answer: 'PLATO', options: ['PLATO', 'MESA', 'LIBRO'], level: 1 },
            { question: "¬øCu√°l es la ra√≠z de 'PESCADOR'?", answer: 'PESCA', options: ['MAR', 'PESCA', 'R√çO'], level: 1 },
            { question: "¬øQu√© significa el sufijo '-ITO'?", answer: 'PEQUE√ëO', options: ['GRANDE', 'GRACIOSO', 'PEQUE√ëO'], level: 1 },
            { question: "¬øCu√°l de estas es una vocal?", answer: 'U', options: ['M', 'S', 'U'], level: 1 },

            // Nivel 2: Sin√≥nimos, Ant√≥nimos, G√©nero y N√∫mero, Sujeto/Predicado.
            { question: "Selecciona una palabra de la familia de 'MAR'.", answer: 'MARINO', options: ['CIELO', 'MONTA√ëA', 'MARINO'], level: 2 },
            { question: "Selecciona un SIN√ìNIMO de 'LINDO'.", answer: 'BONITO', options: ['FEO', 'MALO', 'BONITO'], level: 2 },
            { question: "Selecciona el ANT√ìNIMO de 'ABRIR'.", answer: 'CERRAR', options: ['TAPAR', 'CERRAR', 'VOLAR'], level: 2 },
            { question: "¬øCu√°l de estas palabras es PLURAL (muchos)?", answer: '√ÅRBOLES', options: ['FLOR', '√ÅRBOL', '√ÅRBOLES'], level: 2 },
            { question: "¬øQu√© palabra es la ra√≠z de 'FLORERO'?", answer: 'FLOR', options: ['PLANTA', 'FLOR', 'TIERRA'], level: 2 },
            { question: "¬øCu√°l es el sujeto en: 'El perro corre r√°pido'?", answer: 'EL PERRO', options: ['CORRE R√ÅPIDO', 'EL PERRO', 'R√ÅPIDO'], level: 2 },
            { question: "¬øCu√°l es la palabra que rima con 'VENTANA'?", answer: 'MANZANA', options: ['TELEVISI√ìN', 'MANZANA', 'CAMA'], level: 2 },
            { question: "¬øQu√© es un 'aumentativo' (muy grande)?", answer: 'CASOTA', options: ['CASITA', 'CASOTA', 'CASA'], level: 2 },
            { question: "Selecciona un ANT√ìNIMO de 'F√ÅCIL'.", answer: 'DIF√çCIL', options: ['R√ÅPIDO', 'DIF√çCIL', 'SIMPLE'], level: 2 },
            { question: "¬øCu√°l es el predicado en: 'Mi hermano come mucho'?", answer: 'COME MUCHO', options: ['MI HERMANO', 'COME MUCHO', 'MUCHO'], level: 2 },
            { question: "Selecciona la palabra que rima con 'SOL'.", answer: 'GIRASOL', options: ['CIELO', 'GIRASOL', 'LUNA'], level: 2 },
            { question: "¬øCu√°l de estas palabras es SINGULAR (uno)?", answer: 'L√ÅPIZ', options: ['L√ÅPICES', 'COLORES', 'L√ÅPIZ'], level: 2 },
            { question: "¬øCu√°l es el sujeto en: 'Los ni√±os juegan'?", answer: 'LOS NI√ëOS', options: ['JUEGAN', 'R√ÅPIDO', 'LOS NI√ëOS'], level: 2 },
            { question: "Selecciona un SIN√ìNIMO de 'CONTENTO'.", answer: 'ALEGRE', options: ['TRISTE', 'ENOJADO', 'ALEGRE'], level: 2 },
            { question: "¬øQu√© palabra indica G√âNERO FEMENINO?", answer: 'LA MESA', options: ['EL CARRO', 'LA MESA', 'UN LIBRO'], level: 2 },
            { question: "¬øQu√© palabra tiene el mismo prefijo de 'PRE-ESCOLAR'?", answer: 'PRE-AVISO', options: ['AUTO', 'PRE-AVISO', 'POST'], level: 2 },
            { question: "¬øCu√°l es la ra√≠z de la palabra '√ÅRBOL-EDA'?", answer: '√ÅRBOL', options: ['HOJAS', '√ÅRBOL', 'TRONCO'], level: 2 },
            { question: "Selecciona el ANT√ìNIMO de 'D√çA'.", answer: 'NOCHE', options: ['SOL', 'NOCHE', 'TARDE'], level: 2 },
            { question: "Una palabra PLURAL de 'flor' es...", answer: 'FLORES', options: ['FLORERO', 'FLORAL', 'FLORES'], level: 2 },
            { question: "¬øCu√°l es la palabra que rima con 'QUESO'?", answer: 'PESO', options: ['PAN', 'LECHE', 'PESO'], level: 2 },

            // Nivel 3: Verbos, Adjetivos, Tipos de Oraciones, Puntuaci√≥n
            { question: "¬øQu√© signo termina esta pregunta? ¬øD√≥nde est√°?", answer: 'INTERROGACI√ìN (?)', options: ['PUNTO (.)', 'EXCLAMACI√ìN (!)', 'INTERROGACI√ìN (?)'], level: 3 },
            { question: "Selecciona el nombre femenino.", answer: 'NI√ëA', options: ['PERRO', 'NI√ëO', 'NI√ëA'], level: 3 },
            { question: "Selecciona la oraci√≥n con sujeto y predicado.", answer: 'EL SOL BRILLA', options: ['BRILLA MUCHO', 'EL SOL BRILLA', 'R√ÅPIDO'], level: 3 },
            { question: "¬øQu√© palabra es singular?", answer: 'L√ÅPIZ', options: ['COLORES', 'L√ÅPICES', 'L√ÅPIZ'], level: 3 },
            { question: "¬øC√≥mo se llama el beb√© de la vaca?", answer: 'TERNERO', options: ['POTRO', 'POLLITO', 'TERNERO'], level: 3 },
            { question: "¬øQu√© palabra tiene un diptongo 'UE'?", answer: 'PUERTA', options: ['MESA', 'PUERTA', 'SALA'], level: 3 },
            { question: "Completa: 'El ni√±o come...'", answer: 'MANZANA', options: ['CORRE', 'R√ÅPIDO', 'MANZANA'], level: 3 },
            { question: "¬øQu√© palabra es un adjetivo (describe)?", answer: 'AZUL', options: ['CORRER', 'MESA', 'AZUL'], level: 3 },
            { question: "¬øQu√© signo termina esta exclamaci√≥n? ¬°Qu√© alegr√≠a!", answer: 'EXCLAMACI√ìN (!)', options: ['PUNTO (.)', 'INTERROGACI√ìN (?)', 'EXCLAMACI√ìN (!)'], level: 3 },
            { question: "Selecciona un nombre masculino.", answer: 'LE√ìN', options: ['LEONA', 'NI√ëA', 'LE√ìN'], level: 3 },
            { question: "¬øQu√© palabra es un verbo (acci√≥n)?", answer: 'SALTAR', options: ['CASA', 'ROJO', 'SALTAR'], level: 3 },
            { question: "Completa: 'La mesa es...'", answer: 'GRANDE', options: ['CORRER', 'GRANDE', 'MIRA'], level: 3 },
            { question: "¬øCu√°l es el ADJETIVO en la frase 'oso grande'?", answer: 'GRANDE', options: ['OSO', 'GRANDE', 'Y'], level: 3 },
            { question: "¬øQu√© es un SUSTANTIVO?", answer: 'NOMBRE DE ALGO', options: ['UNA ACCI√ìN', 'UN COLOR', 'NOMBRE DE ALGO'], level: 3 },
            { question: "¬øCu√°l de estas es una Oraci√≥n EXCLAMATIVA?", answer: '¬°QU√â RISA!', options: ['¬øVAS AL PARQUE?', 'HACE SOL.', '¬°QU√â RISA!'], level: 3 },
            { question: "¬øQu√© palabra se usa para UNIR (conjunci√≥n)?", answer: 'Y', options: ['CORRER', 'SOLO', 'Y'], level: 3 },
            { question: "El verbo en pasado (ya termin√≥) de 'CORRER' es...", answer: 'CORRI√ì', options: ['CORRER√Å', 'CORRIENDO', 'CORRI√ì'], level: 3 },
            { question: "¬øCu√°l es la palabra que describe un color?", answer: 'VERDE', options: ['VER', 'VERDE', 'VEREMOS'], level: 3 },
            { question: "Usa PUNTO FINAL en la oraci√≥n:", answer: 'EL CIELO ES AZUL.', options: ['¬øQU√â ES ESTO?', '¬°GENIAL!', 'EL CIELO ES AZUL.'], level: 3 },
            { question: "¬øCu√°l de estas palabras es un PRONOMBRE (ej. √©l)?", answer: 'ELLA', options: ['NI√ëA', 'CASA', 'ELLA'], level: 3 },
        ];

        // Ciencias Sociales: M√°s de 50 preguntas
        const SOCIAL_QUESTIONS = [
            // Nivel 1: Reglas Sociales, Familia y Sentidos
            { question: "¬øQu√© dices despu√©s de recibir un regalo?", answer: 'GRACIAS', options: ['NADA', 'GRACIAS', 'ADI√ìS'], level: 1 },
            { question: "¬øC√≥mo se llama la mam√° de tu mam√°?", answer: 'ABUELA', options: ['T√çA', 'PRIMA', 'ABUELA'], level: 1 },
            { question: "¬øCu√°l es una REGLA de cortes√≠a en la mesa?", answer: 'MASTICAR CON LA BOCA CERRADA', options: ['GRITAR', 'MASTICAR CON LA BOCA CERRADA', 'TIRAR COMIDA'], level: 1 },
            { question: "¬øQu√© debes decir si quieres interrumpir?", answer: 'PERMISO', options: ['CALLA', 'PERMISO', 'DAME'], level: 1 },
            { question: "¬øQu√© parte del cuerpo est√° debajo de la cabeza?", answer: 'CUELLO', options: ['MANO', 'CUELLO', 'PIERNA'], level: 1 },
            { question: "¬øCu√°l es el d√≠a de la semana que va despu√©s del Martes?", answer: 'MI√âRCOLES', options: ['LUNES', 'MI√âRCOLES', 'JUEVES'], level: 1 },
            { question: "¬øCu√°l es un H√ÅBITO SALUDABLE?", answer: 'LAVARSE LOS DIENTES', options: ['COMER DULCES', 'LAVARSE LOS DIENTES', 'NO BA√ëARSE'], level: 1 },
            { question: "¬øCu√°l de estos es un LUGAR P√öBLICO?", answer: 'PARQUE', options: ['MI CASA', 'PARQUE', 'EL DORMITORIO'], level: 1 },
            { question: "¬øC√≥mo se llama el pap√° de tu pap√°?", answer: 'ABUELO', options: ['T√çO', 'ABUELO', 'HERMANO'], level: 1 },
            { question: "¬øQu√© hacemos despu√©s de jugar en el parque?", answer: 'LAVARNOS LAS MANOS', options: ['COMER DULCES', 'LAVARNOS LAS MANOS', 'DORMIR'], level: 1 },
            { question: "¬øQu√© √≥rgano te permite VER los colores?", answer: 'OJO', options: ['O√çDO', 'NARIZ', 'OJO'], level: 1 },
            { question: "¬øCu√°l es la primera estaci√≥n del a√±o?", answer: 'PRIMAVERA', options: ['INVIERNO', 'VERANO', 'PRIMAVERA'], level: 1 },
            { question: "¬øQu√© usas para OLER las flores?", answer: 'NARIZ', options: ['BOCA', 'NARIZ', 'MANO'], level: 1 },
            { question: "¬øCu√°l es la mejor forma de resolver un conflicto?", answer: 'HABLAR', options: ['GRITAR', 'PELEAR', 'HABLAR'], level: 1 },
            { question: "¬øQu√© parte del cuerpo est√° protegida por el CR√ÅNEO?", answer: 'CEREBRO', options: ['CORAZ√ìN', 'CEREBRO', 'H√çGADO'], level: 1 },
            { question: "¬øCu√°ntos D√çAS tiene una semana?", answer: 'SIETE', options: ['CINCO', 'SEIS', 'SIETE'], level: 1 },
            { question: "¬øQu√© debes decir si estornudas?", answer: 'SALUD', options: ['GRACIAS', 'PERD√ìN', 'SALUD'], level: 1 },
            { question: "¬øQu√© haces cuando tienes sue√±o?", answer: 'DORMIR', options: ['COMER', 'DORMIR', 'JUGAR'], level: 1 },
            { question: "¬øQui√©n es el jefe de la casa?", answer: 'LOS PADRES', options: ['EL HERMANO', 'EL PERRO', 'LOS PADRES'], level: 1 },
            { question: "¬øCu√°l es el mes que va despu√©s de Enero?", answer: 'FEBRERO', options: ['MARZO', 'ABRIL', 'FEBRERO'], level: 1 },

            // Nivel 2: Historia Personal, Roles Comunitarios, Derechos
            { question: "¬øCu√°l es el pa√≠s donde naciste?", answer: 'MI PA√çS', options: ['JAP√ìN', 'MI PA√çS', 'EUA'], level: 2 }, // Asume que el ni√±o sabe su pa√≠s
            { question: "¬øQui√©n es la persona que te ense√±a en la escuela?", answer: 'MAESTRO', options: ['DOCTOR', 'MAESTRO', 'POLIC√çA'], level: 2 },
            { question: "¬øQu√© celebra tu familia el d√≠a de tu nacimiento?", answer: 'CUMPLEA√ëOS', options: ['NAVIDAD', 'CUMPLEA√ëOS', 'CARNAVAL'], level: 2 },
            { question: "¬øQui√©n vende la comida en el supermercado?", answer: 'VENDEDOR', options: ['PANADERO', 'VENDEDOR', 'BOMBERO'], level: 2 },
            { question: "¬øCu√°l de estos es un DERECHO de los ni√±os?", answer: 'JUGAR', options: ['NO COMER', 'NO ESTUDIAR', 'JUGAR'], level: 2 },
            { question: "¬øEn qu√© lugar de la comunidad te cortan el cabello?", answer: 'PELUQUER√çA', options: ['HOSPITAL', 'PELUQUER√çA', 'TEATRO'], level: 2 },
            { question: "¬øQu√© debes hacer si ves a alguien triste?", answer: 'PREGUNTAR SI EST√Å BIEN', options: ['IGNORARLO', 'RE√çRME', 'PREGUNTAR SI EST√Å BIEN'], level: 2 },
            { question: "¬øQu√© es un HITO en tu vida (algo importante)?", answer: 'PRIMER D√çA DE CLASES', options: ['UN PAJARO', 'PRIMER D√çA DE CLASES', 'UNA PIEDRA'], level: 2 },
            { question: "¬øCu√°l es la capital de tu pa√≠s?", answer: 'CIUDAD CAPITAL', options: ['MI CIUDAD', 'CIUDAD CAPITAL', 'OTRA CIUDAD'], level: 2 }, // Asume que el ni√±o sabe su capital
            { question: "¬øQu√© significa el color VERDE en el sem√°foro?üö¶", answer: 'AVANZA', options: ['ALTO', 'ESPERA', 'AVANZA'], level: 2 },
            { question: "¬øQui√©n es la persona que revisa tus dientes?", answer: 'DENTISTA', options: ['DOCTOR', 'MAESTRO', 'DENTISTA'], level: 2 },
            { question: "¬øQu√© es importante hacer antes de comer?", answer: 'LAVARSE LAS MANOS', options: ['CORRER', 'GRITAR', 'LAVARSE LAS MANOS'], level: 2 },
            { question: "¬øQu√© hace un POLIC√çA?", answer: 'PROTEGER', options: ['CURAR', 'ENSE√ëAR', 'PROTEGER'], level: 2 },
            { question: "¬øCu√°l es un DERECHO de los ni√±os?", answer: 'TENER NOMBRE', options: ['TENER DINERO', 'TENER UN COCHE', 'TENER NOMBRE'], level: 2 },
            { question: "¬øQu√© haces con tu DOCUMENTO de identidad?", answer: 'IDENTIFICARME', options: ['JUGAR', 'IDENTIFICARME', 'ESCONDERME'], level: 2 },
            { question: "¬øQu√© es una VIRTUD?", answer: 'SER BUENO', options: ['SER MALO', 'SER TONTO', 'SER BUENO'], level: 2 },
            { question: "¬øCu√°l de estos es un MEDIO de transporte TERRESTRE?", answer: 'TREN', options: ['AVI√ìN', 'BARCO', 'TREN'], level: 2 },
            { question: "¬øQu√© es la bandera de tu pa√≠s?", answer: 'S√çMBOLO NACIONAL', options: ['UN TRAPO', 'S√çMBOLO NACIONAL', 'UNA COBJA'], level: 2 },
            { question: "¬øQui√©n cura a los enfermos?", answer: 'M√âDICO', options: ['CHEF', 'M√âDICO', 'BOMBERO'], level: 2 },
            { question: "¬øD√≥nde vas a pedir prestado un libro?", answer: 'BIBLIOTECA', options: ['TIENDA', 'CINE', 'BIBLIOTECA'], level: 2 },

            // Nivel 3: Ciencia B√°sica, Naturaleza Avanzada, Geograf√≠a y Ciclos
            { question: "¬øQu√© es la MATERIA en estado L√çQUIDO?", answer: 'AGUA', options: ['AIRE', 'PIEDRA', 'AGUA'], level: 3 },
            { question: "¬øQu√© es un material de la NATURALEZA?", answer: 'MADERA', options: ['PL√ÅSTICO', 'VIDRIO', 'MADERA'], level: 3 },
            { question: "¬øQu√© causa la LLUVIA?", answer: 'NUBES CARGADAS', options: ['SOL', 'VIENTO', 'NUBES CARGADAS'], level: 3 },
            { question: "¬øCu√°l es un animal HERB√çVORO (solo come plantas)?", answer: 'VACA', options: ['TIGRE', 'VACA', 'LOBO'], level: 3 },
            { question: "¬øQu√© se celebra en NAVIDAD?", answer: 'EL NACIMIENTO DE JES√öS', options: ['EL D√çA DE LA TIERRA', 'EL NACIMIENTO DE JES√öS', 'HALLOWEEN'], level: 3 },
            { question: "¬øC√≥mo se llama el lugar donde vives (casa, edificio)?", answer: 'DOMICILIO', options: ['TIENDA', 'DOMICILIO', 'CASA VECINA'], level: 3 },
            { question: "¬øEn qu√© direcci√≥n SALE el Sol?", answer: 'ESTE', options: ['OESTE', 'SUR', 'ESTE'], level: 3 },
            { question: "¬øQu√© sucede cuando el hielo se DERRITE?", answer: 'SE HACE AGUA', options: ['SE HACE VAPOR', 'SE HACE PIEDRA', 'SE HACE AGUA'], level: 3 },
            { question: "¬øQu√© es la MATERIA en estado S√ìLIDO?", answer: 'PIEDRA', options: ['AGUA', 'AIRE', 'PIEDRA'], level: 3 },
            { question: "¬øCu√°l es un animal CARN√çVORO (solo come carne)?", answer: 'LOBO', options: ['VACA', 'LOBO', 'CONEJO'], level: 3 },
            { question: "¬øQu√© fen√≥meno natural ocurre despu√©s de la lluvia y tiene colores?", answer: 'ARCO√çRIS', options: ['RAYO', 'VIENTO', 'ARCO√çRIS'], level: 3 },
            { question: "¬øCu√°l es el segundo planeta del sistema solar?", answer: 'VENUS', options: ['MARTE', 'VENUS', 'J√öPITER'], level: 3 },
            { question: "¬øCu√°l es el CICLO de la vida de una planta?", answer: 'NACE, CRECE, SE REPRODUCE, MUERE', options: ['NACE Y MUERE', 'NACE, CRECE, SE REPRODUCE, MUERE', 'SOLO CRECE'], level: 3 },
            { question: "¬øQu√© parte de la planta es la que le da soporte?", answer: 'TALLO', options: ['HOJA', 'FLOR', 'TALLO'], level: 3 },
            { question: "¬øQu√© es una monta√±a?", answer: 'ELEVACI√ìN DE TIERRA', options: ['GRAN HUECO', 'ELEVACI√ìN DE TIERRA', 'UN R√çO'], level: 3 },
            { question: "¬øQu√© hace el Sol en el D√çA?", answer: 'ILUMINAR', options: ['CALENTAR', 'ILUMINAR', 'ESCONDERSE'], level: 3 },
            { question: "¬øQu√© animal es OMN√çVORO (come carne y plantas)?", answer: 'CERDO', options: ['VACA', 'LOBO', 'CERDO'], level: 3 },
            { question: "¬øQu√© es un VOLC√ÅN? [Image of Volc√°n]", answer: 'MONTA√ëA CON CR√ÅTER', options: ['UN LAGO', 'MONTA√ëA CON CR√ÅTER', 'UN VALLE'], level: 3 },
            { question: "¬øQu√© elemento causa el VIENTO?", answer: 'MOVIMIENTO DEL AIRE', options: ['EL SOL', 'EL AGUA', 'MOVIMIENTO DEL AIRE'], level: 3 },
            { question: "¬øCu√°l es el principal recurso natural para beber?", answer: 'AGUA', options: ['TIERRA', 'AIRE', 'AGUA'], level: 3 },
        ];
        
        // --- Funciones de Utilidad ---
        
        const shuffleArray = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        };

        const generateFalseOption = (correctAnswer, max, existingOptions) => {
            let option;
            do {
                // Genera un n√∫mero entre 1 y max
                option = Math.floor(Math.random() * max) + 1;
            } while (option === correctAnswer || existingOptions.includes(option));
            return option;
        };

        // --- L√≥gica de los Juegos (Generaci√≥n de Preguntas) ---

        function generateMathQuestion(level) {
            const levelQuestions = MATH_QUESTIONS.filter(q => q.level === level);

            if (levelQuestions.length === 0) return null;
            // Selecciona una pregunta aleatoria
            const q = levelQuestions[Math.floor(Math.random() * levelQuestions.length)];
            
            let correctAnswer, questionText, displayContent = '';
            
            if (q.type === 'count') {
                correctAnswer = q.count;
                questionText = `¬°A contar! ¬øCu√°ntas ${q.object.split(' ')[0]} ves?`;
                const emoji = q.object.split(' ')[1] || '‚≠ê';
                // Genera el string de emojis
                for (let i = 0; i < q.count; i++) {
                    displayContent += emoji + ' ';
                }
            } else if (q.type === 'sum') {
                correctAnswer = q.num1 + q.num2;
                questionText = `¬øCu√°nto es ${q.num1} m√°s ${q.num2}?`;
                displayContent = `${q.num1} ‚ûï ${q.num2}`;
            } else if (q.type === 'subtract') {
                correctAnswer = q.num1 - q.num2;
                questionText = `¬øCu√°nto es ${q.num1} menos ${q.num2}?`;
                displayContent = `${q.num1} ‚ûñ ${q.num2}`;
            } else if (q.type === 'value') {
                correctAnswer = q.answer;
                questionText = q.question;
                displayContent = `${q.number}`; // Muestra el n√∫mero a analizar (ej. 23)
            } else if (q.type === 'sequence' || q.type === 'comparison' || q.type === 'half') {
                correctAnswer = q.answer;
                questionText = q.question;
                // Muestra la parte relevante de la pregunta sin el signo de interrogaci√≥n
                displayContent = q.question.split('?')[0].includes(':') ? q.question.split(':')[1].trim() : q.question.split('?')[0].trim();
            } else if (q.type === 'times') {
                correctAnswer = q.num1 * q.num2;
                questionText = q.question;
                displayContent = q.display;
            }

            // Manejo de opciones de respuesta
            const options = [];
            if (q.options) {
                // Para preguntas con opciones predefinidas (secuencia, comparaci√≥n, etc.)
                options.push(correctAnswer);
                q.options.forEach(opt => {
                    if (opt !== correctAnswer && !options.includes(opt)) {
                        options.push(opt);
                    }
                });
                // Si faltan opciones, genera aleatorias (solo si son n√∫meros)
                if (typeof correctAnswer === 'number' && options.length < 3) {
                     while (options.length < 3) {
                        options.push(generateFalseOption(correctAnswer, q.max || 20, options));
                    }
                }
            } else {
                // Para preguntas de c√°lculo y conteo (n√∫meros)
                options.push(correctAnswer);
                const maxOption = q.max || 20;
                while (options.length < 3) {
                    options.push(generateFalseOption(correctAnswer, maxOption, options));
                }
            }

            gameData = {
                type: 'math',
                questionText: questionText,
                displayContent: displayContent,
                correctAnswer: correctAnswer,
                options: shuffleArray(options)
            };
        }


        function generateReadingQuestion(level) {
            const levelQuestions = READING_QUESTIONS.filter(q => q.level === level);

            if (levelQuestions.length === 0) return null;
            const q = levelQuestions[Math.floor(Math.random() * levelQuestions.length)];
            
            // Defensivamente, asegurar que q.question es una cadena
            const questionString = typeof q.question === 'string' ? q.question : '';

            let displayContent = '';
            if (q.display) {
                displayContent = q.display;
            } else {
                // 1. Tomar la parte despu√©s del primer signo de interrogaci√≥n de apertura (¬ø)
                const parts = questionString.split('¬ø');
                let coreText = parts.length > 1 ? parts[1] : questionString;

                // 2. Eliminar el signo de interrogaci√≥n de cierre (?) y el posible dos puntos (:)
                coreText = coreText.split('?')[0].trim();
                coreText = coreText.split(':')[0].trim();

                displayContent = coreText;
            }
            
            gameData = {
                type: 'reading',
                questionText: questionString,
                // Muestra la palabra clave o la pregunta para evitar "undefined"
                displayContent: displayContent, // Usamos la l√≥gica de extracci√≥n defensiva
                correctAnswer: q.answer,
                options: shuffleArray(q.options)
            };
        }

        function generateSocialQuestion(level) {
            const levelQuestions = SOCIAL_QUESTIONS.filter(q => q.level === level);

            if (levelQuestions.length === 0) return null;
            const q = levelQuestions[Math.floor(Math.random() * levelQuestions.length)];

            const questionString = typeof q.question === 'string' ? q.question : '';
            
            let displayContent = questionString;
            
            if (questionString.includes('?')) {
                // Tomamos la parte antes del primer '?' y luego quitamos el posible ':'
                displayContent = questionString.split('?')[0].trim();
                displayContent = displayContent.split(':')[0].trim();
            }
            
            gameData = {
                type: 'social',
                questionText: questionString,
                // Muestra el emoji o la palabra clave
                displayContent: displayContent, // Usamos la l√≥gica de extracci√≥n defensiva
                correctAnswer: q.answer,
                options: shuffleArray(q.options)
            };
        }

        // --- Manejo de la Respuesta y Transici√≥n ---

        function checkAnswer(selectedOption, element) {
            document.querySelectorAll('.option-tile').forEach(btn => btn.disabled = true);
            
            // Si la respuesta es un n√∫mero, convierte la opci√≥n seleccionada a n√∫mero para la comparaci√≥n
            if (typeof gameData.correctAnswer === 'number') {
                selectedOption = parseInt(selectedOption);
            }

            const isCorrect = selectedOption == gameData.correctAnswer;
            
            // Muestra el feedback en la tarjeta principal
            const mainCard = document.querySelector('.main-card');
            const feedback = document.createElement('div');
            feedback.textContent = isCorrect ? '¬°CORRECTO! ‚úÖ' : '¬°ERROR! ‚ùå';
            feedback.className = `feedback-message ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}`;
            mainCard.appendChild(feedback);

            if (isCorrect) {
                score += 10;
                element.classList.add('correct-answer');
                showMessage('¬°RUNA ACTIVADA! üíé', '¬°Has descifrado el glifo de la sabidur√≠a!');
                setTimeout(() => nextQuestion(), 2000);
            } else {
                element.classList.add('incorrect-answer');
                document.querySelectorAll('.option-tile').forEach(btn => {
                    // La comparaci√≥n debe ser estricta para el texto, o basada en el valor convertido para n√∫meros.
                    const optionValue = (typeof gameData.correctAnswer === 'number') ? parseInt(btn.textContent.trim()) : btn.textContent.trim();
                    if (optionValue == gameData.correctAnswer) {
                        btn.classList.add('correct-answer');
                    }
                });
                showMessage('¬°VUELVE A INTENTARLO! üí™', `La respuesta era: ${gameData.correctAnswer}`);
                setTimeout(() => nextQuestion(), 3000);
            }
        }

        function showMessage(title, message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'message-box';
            messageBox.innerHTML = `
                <div class="message-content">
                    <div class="text-3xl mb-3">${title}</div>
                    <div class="text-xl">${message}</div>
                </div>
            `;
            document.body.appendChild(messageBox);
            // El modal desaparece r√°pido, el feedback visual en el main-card permanece un poco m√°s.
            setTimeout(() => messageBox.remove(), 2000); 
        }

        function nextQuestion() {
            // Elimina el mensaje de feedback antes de la transici√≥n
            const feedback = document.querySelector('.feedback-message');
            if (feedback) feedback.remove();

            currentLevel++;
            if (currentLevel > 3) {
                // FIN del juego, vuelve al men√∫ principal
                window.renderScreen('mainMenu');
            } else {
                // Carga la siguiente pregunta del mismo tema
                if (gameData.type === 'math') {
                    generateMathQuestion(currentLevel);
                    window.renderScreen('mathGame');
                } else if (gameData.type === 'reading') {
                    generateReadingQuestion(currentLevel);
                    window.renderScreen('readingGame');
                } else if (gameData.type === 'social') {
                    generateSocialQuestion(currentLevel);
                    window.renderScreen('socialGame');
                }
            }
        }

        // --- Funciones de Renderizado (UI) ---

        function renderMainMenu() {
            currentScreen = 'mainMenu';
            currentLevel = 1;
            const maxScore = localStorage.getItem('kidIdolsMaxScore7') || 0; 
            score = 0;
            
            app.innerHTML = `
                <div class="main-card p-8 rounded-3xl text-center">
                    <h1 class="title-main text-6xl mb-4 leading-tight">
                        K-SABER MAYA<br>üèõÔ∏è GUARDIANES üèõÔ∏è
                    </h1>
                    <p class="text-3xl font-extrabold text-gray-700 mb-6 font-chivo">
                         ¬°EDICI√ìN 7 A√ëOS!
                    </p>
                    <p class="text-xl font-bold text-gray-700 mb-8">
                        ¬°Descubre los secretos de la Pir√°mide del Conocimiento!
                    </p>

                    <div class="space-y-4">
                        <button onclick="startGame('math')" class="game-button btn-green-jungle w-full">
                            üî¢ C√ÅLCULO Y RUNAS
                        </button>
                        <button onclick="startGame('reading')" class="game-button btn-blue-deep w-full">
                            üìö GLIFOS Y ORACIONES
                        </button>
                        <button onclick="startGame('social')" class="game-button btn-gold-sand w-full">
                            üíñ TEMPLOS Y COMUNIDAD
                        </button>
                    </div>
                    <div class="mt-8 p-4 bg-gray-100 rounded-xl text-lg font-bold text-gray-800 border-2 border-green-700">
                         Puntuaci√≥n M√°xima: <span id="maxScore">${maxScore}</span> ‚≠ê
                    </div>
                    
                    <!-- REQUERIMIENTO DEL CLIENTE -->
                    <div class="mt-6 text-center text-sm font-bold text-gray-700">
                        <p>Creado y mantenido por **neuralcodelab.com**.</p>
                        <p class="text-xs text-gray-500">Cont√°ctanos para mejoras o nuevas funciones.</p>
                    </div>
                </div>
            `;
            document.getElementById('maxScore').textContent = maxScore;
        }

        function renderGameScreen() {
            const gameTitle = {
                'math': 'üî¢ SECRETO NUM√âRICO',
                'reading': 'üìö ARQUE√ìLOGO DE PALABRAS',
                'social': 'üíñ LEYENDAS Y MUNDO'
            }[currentScreen];

            app.innerHTML = `
                <div class="main-card p-6 rounded-3xl text-center relative">
                    <div class="flex justify-between items-center mb-6">
                        <button onclick="renderScreen('mainMenu')" class="game-button btn-green-jungle py-2 px-4 text-base">
                            üè† MEN√ö
                        </button>
                        <h2 class="text-2xl md:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-700 to-blue-800 font-chivo">
                            ${gameTitle}
                        </h2>
                        <div class="score-badge">‚≠ê ${score}</div>
                    </div>
                    
                    <div class="level-badge mb-6">Nivel ${currentLevel} üéØ</div>
                    
                    <p class="text-2xl font-bold text-gray-700 mb-4">${gameData.questionText}</p>
                    
                    <div class="display-content">
                        ${gameData.displayContent}
                    </div>

                    <div id="optionsContainer" class="grid grid-cols-2 gap-4">
                        <!-- Opciones se inyectan aqu√≠ -->
                    </div>
                    
                    <!-- REQUERIMIENTO DEL CLIENTE -->
                    <div class="mt-6 text-center text-xs font-bold text-gray-500">
                        App creada por neuralcodelab.com
                    </div>
                </div>
            `;
            renderOptions();
        }

        function renderOptions() {
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            gameData.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'option-tile';
                button.onclick = (e) => checkAnswer(option, e.target);
                optionsContainer.appendChild(button);
            });
        }
        
        // --- Control Principal Globalizado ---
        
        window.startGame = (gameType) => {
            currentLevel = 1;
            score = 0;
            if (gameType === 'math') {
                generateMathQuestion(currentLevel);
                window.renderScreen('mathGame');
            } else if (gameType === 'reading') {
                generateReadingQuestion(currentLevel);
                window.renderScreen('readingGame');
            } else if (gameType === 'social') {
                generateSocialQuestion(currentLevel);
                window.renderScreen('socialGame');
            }
        };

        window.renderScreen = (screenName) => {
            currentScreen = screenName;
            if (screenName === 'mainMenu') {
                renderMainMenu();
            } else if (screenName.endsWith('Game')) {
                // Actualiza la puntuaci√≥n m√°xima usando la clave K-IDOLS7
                const maxScore = parseInt(localStorage.getItem('kidIdolsMaxScore7') || 0);
                if (score > maxScore) {
                    localStorage.setItem('kidIdolsMaxScore7', score);
                }
                renderGameScreen();
            }
        };
        
        // Inicio de la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            window.renderScreen('mainMenu');
        });
        
    </script>
</body>
</html>